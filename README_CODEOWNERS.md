# CODEOWNERS

In this repository, [GitHub CODEOWNERS](https://help.github.com/en/articles/about-code-owners) is used to claim ownership of a piece of code to a team.

The `codeowners` rule makes sure that a member of the owner team reviews all changes made to the code that they are owning.

All members of the engineering organization are of course welcome to alter code owned by other teams.

## Claiming ownership

The first thing that you need to do, is to figure out what should be owned by whom.

When you know that, add a `codeowners` rule to the `BUILD` file at the root of the project.

More documentation about `rules_codeowners` can be found [here](http://github.com/zegl/rules_codeowners/).

```bzl
load("@rules_codeowners//tools:codeowners.bzl", "codeowners")

codeowners(
    name = "owners",
    team = "@tink-ab/aggregation-squad",
    visibility = ["//:__pkg__"],
)
```

All rules at all paths needs to be referenced by the `//:generate_codeowners` rule, add the path to your `target` in the `owners` list. A test will remind you to do this if you forget it.

The path to the source is automatically detected, which means that we're always sure that the `CODOWNERS` file is up to date.

## Generating the CODEOWNERS

The CODEOWNERS file is generated by running `bazel build //:generate_codeowners`. You can inspect the output by running `cat bazel-bin/generate_codeowners.out`.

Copy the generated output to `CODOWNERS` if you've made any changes. We have a test (`//:validate_codeowners_up_to_date`) that asserts that this has been done.


```bash
# Generate and inspect
bazel build //:generate_codeowners && cat bazel-bin/generate_codeowners.out

# Generate and overwrite
bazel build //:generate_codeowners && cp bazel-bin/generate_codeowners.out CODEOWNERS
```
