syntax = "proto3";

option java_multiple_files = true;
option java_package = "se.tink.sa.model.auth";
option java_outer_classname = "OuterModel";
option go_package = "proto";

import "google/type/date.proto";
import "src/integration/sa_agent/sa_grpc_api/proto/common/io_common.proto";
import "src/integration/sa_agent/sa_grpc_api/proto/security/model.proto";

message AuthenticationRequest {
  RequestCommon requestCommon = 1;
  Credentials credentials = 2;
  repeated string userInputs = 3;
  map<string, string> callbackData = 4;
}

message AuthenticationResponse {
  ResponseCommon responseCommon = 1;
  repeated Field fields = 2;
  ThirdPartyAppAuthenticationPayload payload = 3;
  SupplementalWaitRequest supplementalWaitRequest = 4;
  string stepId = 5;
  SecurityInfo securityInfo = 6;
}

message Field {
  string description = 1;
  string helpText = 2;
  string hint = 3;
  bool immutable = 4;
  bool masked = 5;
  int32 maxLength = 6;
  int32 minLength = 7;
  string name = 8;
  bool numeric = 9;
  bool optional = 10;
  string pattern = 11;
  string patternError = 12;
  string value = 13;
  bool sensitive = 14;
  bool checkbox = 15;
  string additionalInfo = 16;
}

message Credentials {
  google.type.Date debugUntil = 1;
  int64 providerLatency = 2;
  string id = 3;
  google.type.Date nextUpdate = 4;
  string payload = 5;
  string providerName = 6;
  google.type.Date sessionExpiryDate = 7;
  CredentialsStatus status = 8;
  string statusPayload = 9;
  string statusPrompt = 10;
  google.type.Date statusUpdated = 11;
  string supplementalInformation = 12;
  CredentialsTypes type = 13;
  google.type.Date updated = 14;
  string userId = 15;
  bool forceManualAuthentication = 16;
  int32 dataVersion = 17;

  enum CredentialsStatus {
    CREATED = 0;
    AUTHENTICATING = 1;
    UNCHANGED = 2;
    UPDATING = 3;
    UPDATED = 4;
    AWAITING_MOBILE_BANKID_AUTHENTICATION = 5;
    AWAITING_THIRD_PARTY_APP_AUTHENTICATION = 6;
    AWAITING_SUPPLEMENTAL_INFORMATION = 7;
    AWAITING_OTHER_CREDENTIALS_TYPE = 8;
    AUTHENTICATION_ERROR = 9;
    NOT_IMPLEMENTED_ERROR = 10;
    TEMPORARY_ERROR = 11;
    HINTED = 12;
    PERMANENT_ERROR = 13;
    DELETED = 14;
    METRIC = 15;
    DISABLED = 16;
    SESSION_EXPIRED = 17;
  }

  enum CredentialsTypes {
    PASSWORD = 0;
    MOBILE_BANKID = 1;
    KEYFOB = 2;
    FRAUD = 3;
    THIRD_PARTY_APP = 4;
  }
}

message ThirdPartyAppAuthenticationPayload {
  Android android = 1;
  Ios ios = 2;
  Desktop desktop = 3;
  string downloadTitle = 4;
  string downloadMessage = 5;
  string upgradeTitle = 6;
  string upgradeMessage = 7;

  message Android {
    string packageName = 1;
    int32 requiredMinimumVersion = 2;
    string intent = 3;
  }

  message Ios {
    string appStoreUrl = 1;
    string scheme = 2;
    string deepLinkUrl = 3;
  }

  message Desktop {
    string url = 1;
  }
}

message SupplementalWaitRequest {
  string key = 1;
  int64 waitFor = 2;
  TimeUnit timeUnit = 3; // TODO: java.util.concurrent.TimeUnit
  enum TimeUnit {
    NANOSECONDS = 0;
    MICROSECONDS = 1;
    MILLISECONDS = 2;
    SECONDS = 3;
    MINUTES = 4;
    HOURS = 5;
    DAYS = 6;
  }
}

message GetConsentStatusRequest {
  RequestCommon requestCommon = 1;
}

message GetConsentStatusResponse {
  ResponseCommon responseCommon = 1;
  string transactionStatus = 2;
}