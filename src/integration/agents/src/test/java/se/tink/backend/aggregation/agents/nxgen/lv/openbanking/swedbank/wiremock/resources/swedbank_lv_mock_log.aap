REQUEST 1
POST https://psd2.api.swedbank.com/psd2/v3/authorize-decoupled?bic=HABALV22
Accept: application/json
Content-Type: application/json
X-Aggregator: Tink Testing

{"authenticationMethodId":"SMART_ID","clientID":"dummyClientId","psuData":{"personalID":"200012121213"},"redirectUri":"https://127.0.0.1:7357/api/v1/thirdparty/callback","scope":"PSD2"}

RESPONSE 1
200
ASPSP-SCA-Approach: ***
X-Rate-Limit-Limit: 80000
X-Rate-Limit-Remaining: 77596
X-Rate-Limit-Reset: 214
Content-Type: application/json;charset=utf-8
Server: Layer7-API-Gateway
Content-Length: 480

{
    "authorizeId" : "1612345678-1234-1234-1234-123456789123",
    "chosenScaMethod" : {
    		"authenticationType" : "Smart-ID",
    		"authenticationMethodId" : "SMART_ID"
    },
    "challengeData" : { "code": "9928" },
    "psuMessage" : "Request is sent to your device. Compare the code and enter PIN1.",
    "_links": {
         "scaStatus": {
         	    "href": "/psd2/v3/authorize-decoupled/authorize/1612345678-1234-1234-1234-123456789123"
         }
    }
}

REQUEST 2
GET https://psd2.api.swedbank.com/psd2/v3/authorize-decoupled/authorize/1612345678-1234-1234-1234-123456789123?bic=HABALV22&client_id=dummyClientId
Accept: application/json
X-Aggregator: Tink Testing

RESPONSE 2
200
X-Rate-Limit-Limit: 80000
X-Rate-Limit-Remaining: 77592
X-Rate-Limit-Reset: 201
Content-Type: application/json;charset=utf-8
Server: Layer7-API-Gateway

{
  "scaStatus": "finalised",
  "authorizationCode": "abcdefab-abcd-abcd-abcd-abcdefabcdef"
}

REQUEST 3
POST https://psd2.api.swedbank.com/psd2/token?bic=HABALV22&code=abcdefab-abcd-abcd-abcd-abcdefabcdef&grant_type=authorization_code&client_secret=dummyClientSecret&redirect_uri=https%3A%2F%2F127.0.0.1%3A7357%2Fapi%2Fv1%2Fthirdparty%2Fcallback&client_id=dummyClientId
Accept: application/json
Content-Type: application/x-www-form-urlencoded
X-Aggregator: Tink Testing

RESPONSE 3
200
Pragma: no-cache
Cache-Control: no-store
Content-Type: application/json;charset=utf-8
Server: Layer7-API-Gateway

{"access_token":"ACCESS_TOKEN", "token_type":"Bearer", "expires_in":599, "refresh_token":"REFRESH_TOKEN", "scope":"PSD2 PSD2account_list"}

REQUEST 4
POST https://psd2.api.swedbank.com/v3/consents?bic=HABALV22&app-id=dummyClientId
Accept: application/json
PSU-User-Agent: Tink
PSU-IP-Port: 443
TPP-Redirect-URI: https://127.0.0.1:7357/api/v1/thirdparty/callback
Content-Type: application/json
X-Aggregator: Tink Testing

{"recurringIndicator":false,"validUntil":"1992-07-09","frequencyPerDay":4,"combinedServiceIndicator":false,"access":{"availableAccounts":"allAccounts"}}

RESPONSE 4 SET ACCOUNTS_WITHOUT_CONSENT
201
X-Rate-Limit-Limit: 80000
X-Rate-Limit-Remaining: 77587
X-Rate-Limit-Reset: 199
Content-Type: application/json;charset=utf-8
Server: Layer7-API-Gateway

{"consentId":"12345678-abcd-abcd-abcd-123456789123","consentStatus":"valid"}

REQUEST 5 MATCH ACCOUNTS_WITHOUT_CONSENT
GET https://psd2.api.swedbank.com/v3/accounts?bic=HABALV22&app-id=dummyClientId
Accept: application/json
PSU-IP-Address: 127.0.0.1
PSU-User-Agent: Tink
PSU-IP-Port: 443
X-Aggregator: Tink Testing

RESPONSE 5
200
X-Rate-Limit-Limit: 80000
X-Rate-Limit-Remaining: 77586
X-Rate-Limit-Reset: 198
Content-Type: application/json;charset=utf-8
Server: Layer7-API-Gateway

{"accounts":[{"resourceId":"12341122333444466666655555aaaaaa","iban":"LV16HABA1234567891234","cashAccountType":"CACC","currency":"XXX","product":"CURRENT"}]}

REQUEST 6
POST https://psd2.api.swedbank.com/v3/consents?bic=HABALV22&app-id=dummyClientId
Accept: application/json
PSU-User-Agent: Tink
PSU-IP-Port: 443
TPP-Redirect-URI: https://127.0.0.1:7357/api/v1/thirdparty/callback
Content-Type: application/json
X-Aggregator: Tink Testing

{"recurringIndicator":true,"validUntil":"1992-07-09","frequencyPerDay":4,"combinedServiceIndicator":false,"access":{"accounts":[{"iban":"LV16HABA1234567891234"},{"iban":"LV16HABA1234567891234"}],"transactions":[{"iban":"LV16HABA1234567891234"},{"iban":"LV16HABA1234567891234"}],"balances":[{"iban":"LV16HABA1234567891234"},{"iban":"LV16HABA1234567891234"}]}}

RESPONSE 6
201
X-Rate-Limit-Limit: 80000
X-Rate-Limit-Remaining: 77585
X-Rate-Limit-Reset: 197
Content-Type: application/json;charset=utf-8
Server: Layer7-API-Gateway

{"consentId":"22222233-4444-4444-4444-223332255555","chosenScaMethod":{"authenticationMethodId":"SMART_ID","authenticationType":"Smart-ID"},"scaMethods":[{"authenticationMethodId":"SMART_ID","authenticationType":"Smart-ID"}],"_links":{"status":{"href":"/v3/consents/22222233-4444-4444-4444-223332255555/status"},"scaStatus":{"href":"/v3/consents/22222233-4444-4444-4444-223332255555/authorisations/022222233-4444-4444-4444-223332255566"},"startAuthorisationWithAuthenticationMethodSelection":{"href":"/v3/consents/22222233-4444-4444-4444-223332255555/authorisations/022222233-4444-4444-4444-223332255566"}},"consentStatus":"received"}

REQUEST 7
PUT https://psd2.api.swedbank.com/v3/consents/22222233-4444-4444-4444-223332255555/authorisations/022222233-4444-4444-4444-223332255566?bic=HABALV22
Accept: application/json
PSU-IP-Address: 127.0.0.1
PSU-User-Agent: Tink
PSU-IP-Port: 443
Content-Type: application/json
X-Aggregator: Tink Testing

{"authenticationMethodId":"SMART_ID"}

RESPONSE 7
200
X-Rate-Limit-Limit: 80000
X-Rate-Limit-Remaining: 77584
X-Rate-Limit-Reset: 197
Content-Type: application/json;charset=utf-8
Server: Layer7-API-Gateway
Content-Length: 327

{"scaStatus":"started","chosenScaMethod":{"authenticationMethodId":"SMART_ID","authenticationType":"Smart-ID"},"challengeData":{"code":"7019"},"_links":{"scaStatus":{"href":"/v3/consents/22222233-4444-4444-4444-223332255555/authorisations/022222233-4444-4444-4444-223332255566"}},"psuMessage":"Detailed info for 1 acc. Tink AB"}

REQUEST 8
GET https://psd2.api.swedbank.com/v3/consents/22222233-4444-4444-4444-223332255555/authorisations/022222233-4444-4444-4444-223332255566?bic=HABALV22
Accept: application/json
PSU-IP-Address: 127.0.0.1
PSU-User-Agent: Tink
PSU-IP-Port: 443
X-Aggregator: Tink Testing

RESPONSE 8 SET SMART_ID_AUTHORIZED
200
X-Rate-Limit-Limit: 80000
X-Rate-Limit-Remaining: 77580
X-Rate-Limit-Reset: 191
Content-Type: application/json;charset=utf-8
Server: Layer7-API-Gateway
Content-Length: 23

{"scaStatus":"started"}

REQUEST 9 MATCH SMART_ID_AUTHORIZED
GET https://psd2.api.swedbank.com/v3/consents/22222233-4444-4444-4444-223332255555/authorisations/022222233-4444-4444-4444-223332255566?bic=HABALV22
Accept: application/json
PSU-IP-Address: 127.0.0.1
PSU-User-Agent: Tink
PSU-IP-Port: 443
X-Aggregator: Tink Testing

RESPONSE 9
200
X-Rate-Limit-Limit: 80000
X-Rate-Limit-Remaining: 77577
X-Rate-Limit-Reset: 187
Content-Type: application/json;charset=utf-8
Server: Layer7-API-Gateway
Content-Length: 25

{"scaStatus":"finalised"}

REQUEST 10
GET https://psd2.api.swedbank.com/v3/consents/22222233-4444-4444-4444-223332255555/status?bic=HABALV22
Accept: application/json
PSU-IP-Address: 127.0.0.1
PSU-User-Agent: Tink
PSU-IP-Port: 443
X-Aggregator: Tink Testing

RESPONSE 10
200
X-Rate-Limit-Limit: 80000
X-Rate-Limit-Remaining: 77576
X-Rate-Limit-Reset: 186
Content-Type: application/json;charset=utf-8
Server: Layer7-API-Gateway
Content-Length: 25

{"consentStatus":"valid"}

REQUEST 11
GET https://psd2.api.swedbank.com/v3/accounts?bic=HABALV22&app-id=dummyClientId
Accept: application/json
PSU-IP-Address: 127.0.0.1
PSU-User-Agent: Tink
PSU-IP-Port: 443
X-Aggregator: Tink Testing

RESPONSE 11
200
X-Rate-Limit-Limit: 80000
X-Rate-Limit-Remaining: 77586
X-Rate-Limit-Reset: 198
Content-Type: application/json;charset=utf-8
Server: Layer7-API-Gateway

{"accounts":[{"resourceId":"12341122333444466666655555aaaaaa","iban":"LV16HABA1234567891234","cashAccountType":"CACC","currency":"XXX","product":"CURRENT","_links":{"balances":{"href":"/v3/accounts/12341122333444466666655555aaaaaa/balances"},"transactions":{"href":"/v3/accounts/12341122333444466666655555aaaaaa/transactions"}}}]}

REQUEST 12
GET https://psd2.api.swedbank.com/v3/accounts/12341122333444466666655555aaaaaa/balances?bic=HABALV22
Accept: application/json
PSU-IP-Address: 127.0.0.1
PSU-User-Agent: Tink
PSU-IP-Port: 443
X-Aggregator: Tink Testing

RESPONSE 12
200
X-Rate-Limit-Limit: 80000
X-Rate-Limit-Remaining: 77574
X-Rate-Limit-Reset: 184
Content-Type: application/json;charset=utf-8
Server: Layer7-API-Gateway
Content-Length: 285

{"account":{"iban":"LV16HABA1234567891234"},"balances":[{"balanceType":"authorised","balanceAmount":{"currency":"EUR","amount":"478.06"},"referenceDate":"2021-09-10"},{"balanceType":"interimAvailable","balanceAmount":{"currency":"EUR","amount":"478.06"},"referenceDate":"2021-09-10"}]}

REQUEST 13
POST https://psd2.api.swedbank.com/v3/accounts/12341122333444466666655555aaaaaa/transactions?bic=HABALV22&dateFrom=1990-03-10&dateTo=1992-01-12&bookingStatus=booked
Accept: application/json
PSU-IP-Address: 127.0.0.1
PSU-User-Agent: Tink
PSU-IP-Port: 443
TPP-Redirect-URI: https://127.0.0.1:7357/api/v1/thirdparty/callback
TPP-Nok-Redirect-URI: https://127.0.0.1:7357/api/v1/thirdparty/callback
X-Aggregator: Tink Testing

RESPONSE 13
201
X-Rate-Limit-Limit: 80000
X-Rate-Limit-Remaining: 77573
X-Rate-Limit-Reset: 184
Content-Type: application/json;charset=utf-8
Server: Layer7-API-Gateway

{"statementStatus":"received","statementId":"22222255-4444-4444-4444-2233322555587","psuMessage":"Authorise LV16HABA1234567891234 account statement from 2019-08-10 to 2021-06-13","_links":{"status":{"href":"/v3/accounts/12341122333444466666655555aaaaaa/transactions/22222255-4444-4444-4444-2233322555587/status"},"scaStatus":{"href":"/v3/accounts/12341122333444466666655555aaaaaa/transactions/22222255-4444-4444-4444-2233322555587/authorisations/3ae40a63-bfad-40e1-8e57-a26c5e592447"},"scaRedirect":{"href":"https://psd2.swedbank.lv/account/transactions/123456789987654322"}}}

REQUEST 14
GET https://psd2.api.swedbank.com/v3/accounts/12341122333444466666655555aaaaaa/transactions?bic=HABALV22&dateFrom=1992-01-12&dateTo=1992-04-10&bookingStatus=both
Accept: application/json
PSU-IP-Address: 127.0.0.1
PSU-User-Agent: Tink
X-Aggregator: Tink Testing

RESPONSE 14
200
X-Rate-Limit-Limit: 80000
X-Rate-Limit-Remaining: 64485
X-Rate-Limit-Reset: 178
Content-Type: application/json;charset=utf-8
Server: Layer7-API-Gateway


{"account":{"iban":"LV16HABA1234567891234","ownerName":"OWNER NAME"},"transactions":{"booked":[{"transactionId":"2021062112345678-1","creditorName":"TET SIA","creditorAccount":{"iban":"LV1234512345123450000"},"transactionAmount":{"currency":"EUR","amount":"-24.88"},"bankTransactionCode":"PMNT","bookingDate":"2021-06-21","valueDate":"2021-06-21","remittanceInformationUnstructured":"HP0000012345678:Tet rekina 22334455-6 (konts 1234567) samaksaname.","remittanceInformationStructured":"HP0000012345678"},{"transactionId":"2021062712345678-1","creditorName":"OWNER NAME ","creditorAccount":{"iban":"LV1234512345123450001"},"transactionAmount":{"currency":"EUR","amount":"-60.31"},"bankTransactionCode":"PMNT","bookingDate":"2021-06-27","valueDate":"2021-06-27","remittanceInformationUnstructured":"Elektrum Jūnijs "}, {"transactionId":"2021080612345678-1","debtorName":"IĻJA FEŠČENKO","debtorAccount":{"iban":"LV222444433322224444"},"transactionAmount":{"currency":"EUR","amount":"200.00"},"bankTransactionCode":"PMNT","bookingDate":"2021-08-06","valueDate":"2021-08-06","remittanceInformationUnstructured":"par komunāliem - Augusts 2021"},{"transactionId":"2021080812345678-1","creditorName":"EDEN SPRINGS LATVIA SIA","creditorAccount":{"iban":"LV1234512345123450002"},"transactionAmount":{"currency":"EUR","amount":"-18.00"},"bankTransactionCode":"PMNT","bookingDate":"2021-08-08","valueDate":"2021-08-08","remittanceInformationUnstructured":"Klienta numurs: 7654321, Rēķina numurs: 00/12345678"},{"transactionId":"2021080812345678-1","creditorName":"TET SIA","creditorAccount":{"iban":"LV1234512345123450000"},"transactionAmount":{"currency":"EUR","amount":"-24.88"},"bankTransactionCode":"PMNT","bookingDate":"2021-08-08","valueDate":"2021-08-08","remittanceInformationUnstructured":"HP0000012345679:Tet rekina 22334455-1 (konts 1234567) samaksa.","remittanceInformationStructured":"HP0000012345679"},{"transactionId":"2021080812345678-1","creditorName":"LATVENERGO AS","creditorAccount":{"iban":"LV1234512345123450003"},"transactionAmount":{"currency":"EUR","amount":"-66.60"},"bankTransactionCode":"PMNT","bookingDate":"2021-08-08","valueDate":"2021-08-08","remittanceInformationUnstructured":"12345600000, 12345670000"},{"transactionId":"2021080812345678-1","endToEndId":"NOTPROVIDED","debtorName":"Debtor name","debtorAccount":{"iban":"LV1234512345123450004"},"transactionAmount":{"currency":"EUR","amount":"150.00"},"bankTransactionCode":"PMNT","bookingDate":"2021-08-08","valueDate":"2021-08-08","remittanceInformationUnstructured":"Augusts"},{"transactionId":"2021081012345678-1","creditorName":"ZIEMEĻNAMS DZĪVOKĻU ĪPAŠNIEKU KOOPERATĪVĀ SABIEDRĪBA","creditorAccount":{"iban":"LV1234512345123450005"},"transactionAmount":{"currency":"EUR","amount":"-141.92"},"bankTransactionCode":"PMNT","bookingDate":"2021-08-10","valueDate":"2021-08-10","remittanceInformationUnstructured":"RĒĶINS NR.00-00, Augusta, name"},{"transactionId":"2021090512345678-1","debtorName":"IĻJA FEŠČENKO","debtorAccount":{"iban":"LV222444433322224444"},"transactionAmount":{"currency":"EUR","amount":"200.00"},"bankTransactionCode":"PMNT","bookingDate":"2021-09-05","valueDate":"2021-09-05","remittanceInformationUnstructured":"par komunāliem - Septembris 2021"},{"transactionId":"2021090712345678-1","transactionAmount":{"currency":"EUR","amount":"-1.41"},"bankTransactionCode":"PMNT","bookingDate":"2021-09-07","valueDate":"2021-09-07","remittanceInformationUnstructured":"Kartes mēneša maksa 111111******1234 08.2021"},{"transactionId":"2021090812345678-1","endToEndId":"NOTPROVIDED","debtorName":"Debtor name","debtorAccount":{"iban":"LV1234512345123450006"},"transactionAmount":{"currency":"EUR","amount":"150.00"},"bankTransactionCode":"PMNT","bookingDate":"2021-09-08","valueDate":"2021-09-08","remittanceInformationUnstructured":"Septembris"}],"pending":[]}}

