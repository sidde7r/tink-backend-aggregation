package se.tink.backend.aggregation.agents.nxgen.pt.banks.bancobpi.product;

import java.io.IOException;
import java.math.BigDecimal;
import org.junit.Assert;
import org.junit.Test;
import se.tink.backend.aggregation.agents.common.RequestException;
import se.tink.backend.aggregation.agents.nxgen.pt.banks.bancobpi.entity.BancoBpiProductData;

public class ProductsFetchResponseTest {

    private static final String RESPONSE_EXPECTED =
            "{\"versionInfo\": {\"hasModuleVersionChanged\": false,\"hasApiVersionChanged\": false},\"data\": {\"POSIFamila\": {\"Descricao\": \"Activos\",\"Total\": \"3637.24\",\"SubFamiliaList\": {\"List\": [{\"IS_POSISubFamilia\": {\"CodigoAlfa\": \"A00\",\"Descricao\": \"Depósitos à ordem\",\"Total\": \"1237.24\",\"ProdutoList\": {\"List\": [{\"IS_POSIProduto\": {\"CodigoFamilia\": \"0\",\"CodigoSubFamilia\": \"0\",\"Codigo\": \"25\",\"DescricaoTitulo\": \"CONTA VALOR BPI\",\"Valor\": \"1237.24\",\"ValorMoedaProduto\": \"1237.24\",\"NumeroOperacao\": \"1962511000001\",\"DescricaoOperacao\": \"DISPONIBILIDADES\",\"DataProcessamento\": \"2019-12-17T00:00:00Z\",\"NIP\": \"3705693\",\"CodigoTipoOperacao\": 10,\"CodigoMoeda\": \"EUR\",\"CodigoSituacao\": 2,\"DescricaoSituacao\": \"REGULAR\",\"CodigoProdutoAplicacional\": \"350\",\"dataFimOperacao\": \"1900-01-01\",\"CodigoAplicacional\": \"\",\"DadosOIC\": {\"CodigoAplicacao\": \"\",\"DataInicioOperacao\": \"1900-01-01\",\"DataFimOperacao\": \"1900-01-01\",\"NumeroUnidades\": \"0.0\",\"DadosTaxa\": {\"ValorActual\": \"0.0\",\"DataInicio\": \"1900-01-01\",\"DataFim\": \"1900-01-01\",\"ValorDevedora\": \"0.0\",\"ValorCredora\": \"0.0\"},\"DadosLimiteCredito\": {\"Valor\": \"0.0\",\"DataFim\": \"1900-01-01\"},\"ValorIncumprimento\": \"0.0\",\"DataIncumprimento\": \"1900-01-01\",\"MontanteMedioUltimos3Meses\": \"0.0\",\"TipoAgregador\": \"Disponibilidades\"}}}]},\"Cor\": \"#FF6200\",\"ProdutoPrivateList\": {\"List\": [],\"EmptyListItem\": {\"IS_POSIProdutoPrivate\": {\"CodigoFamilia\": \"\",\"CodigoSubFamilia\": \"\",\"Codigo\": \"\",\"DescricaoTitulo\": \"\",\"NumeroOperacao\": \"0\",\"CodigoMoeda\": \"\",\"ValorAplicado\": \"0.0\",\"ValorMoedaProduto\": \"0.0\",\"Valor\": \"0.0\",\"Taxa\": \"0.0\",\"Ultimacotacao\": \"\",\"QuantidadeMontante\": \"0.0\",\"QuantidadeMontante2\": \"0.0\",\"PercentagemCarteira\": \"0.0\",\"CodigoAplicacional\": \"\"}}},\"Order\": \"0\"}}, {\"IS_POSISubFamilia\": {\"CodigoAlfa\": \"A01\",\"Descricao\": \"Aplicações de Prazo Fixo\",\"Total\": \"2400\",\"ProdutoList\": {\"List\": [{\"IS_POSIProduto\": {\"CodigoFamilia\": \"1\",\"CodigoSubFamilia\": \"4\",\"Codigo\": \"173\",\"DescricaoTitulo\": \"BPI POUPANCA Férias de Verão\",\"Valor\": \"200.00\",\"ValorMoedaProduto\": \"200.00\",\"NumeroOperacao\": \"196251143100801\",\"DescricaoOperacao\": \"DISPONIBILIDADES\",\"DataProcessamento\": \"2019-12-17T00:00:00Z\",\"NIP\": \"3705693\",\"CodigoTipoOperacao\": 10,\"CodigoMoeda\": \"EUR\",\"CodigoSituacao\": 2,\"DescricaoSituacao\": \"REGULAR\",\"CodigoProdutoAplicacional\": \"0\",\"dataFimOperacao\": \"1900-01-01\",\"CodigoAplicacional\": \"\",\"DadosOIC\": {\"CodigoAplicacao\": \"\",\"DataInicioOperacao\": \"1900-01-01\",\"DataFimOperacao\": \"1900-01-01\",\"NumeroUnidades\": \"0.0\",\"DadosTaxa\": {\"ValorActual\": \"0.0\",\"DataInicio\": \"1900-01-01\",\"DataFim\": \"1900-01-01\",\"ValorDevedora\": \"0.0\",\"ValorCredora\": \"0.0\"},\"DadosLimiteCredito\": {\"Valor\": \"0.0\",\"DataFim\": \"1900-01-01\"},\"ValorIncumprimento\": \"0.0\",\"DataIncumprimento\": \"1900-01-01\",\"MontanteMedioUltimos3Meses\": \"0.0\",\"TipoAgregador\": \"Disponibilidades\"}}}, {\"IS_POSIProduto\": {\"CodigoFamilia\": \"1\",\"CodigoSubFamilia\": \"4\",\"Codigo\": \"173\",\"DescricaoTitulo\": \"BPI POUPANCA Manutenção Automóvel\",\"Valor\": \"200.00\",\"ValorMoedaProduto\": \"200.00\",\"NumeroOperacao\": \"196251143100701\",\"DescricaoOperacao\": \"DISPONIBILIDADES\",\"DataProcessamento\": \"2019-12-17T00:00:00Z\",\"NIP\": \"3705693\",\"CodigoTipoOperacao\": 10,\"CodigoMoeda\": \"EUR\",\"CodigoSituacao\": 2,\"DescricaoSituacao\": \"REGULAR\",\"CodigoProdutoAplicacional\": \"0\",\"dataFimOperacao\": \"1900-01-01\",\"CodigoAplicacional\": \"\",\"DadosOIC\": {\"CodigoAplicacao\": \"\",\"DataInicioOperacao\": \"1900-01-01\",\"DataFimOperacao\": \"1900-01-01\",\"NumeroUnidades\": \"0.0\",\"DadosTaxa\": {\"ValorActual\": \"0.0\",\"DataInicio\": \"1900-01-01\",\"DataFim\": \"1900-01-01\",\"ValorDevedora\": \"0.0\",\"ValorCredora\": \"0.0\"},\"DadosLimiteCredito\": {\"Valor\": \"0.0\",\"DataFim\": \"1900-01-01\"},\"ValorIncumprimento\": \"0.0\",\"DataIncumprimento\": \"1900-01-01\",\"MontanteMedioUltimos3Meses\": \"0.0\",\"TipoAgregador\": \"Disponibilidades\"}}}, {\"IS_POSIProduto\": {\"CodigoFamilia\": \"1\",\"CodigoSubFamilia\": \"4\",\"Codigo\": \"104\",\"DescricaoTitulo\": \"CONTA POUPANCA RENDIMENTO\",\"Valor\": \"1000.00\",\"ValorMoedaProduto\": \"1000.00\",\"NumeroOperacao\": \"196251112801001\",\"DescricaoOperacao\": \"DISPONIBILIDADES\",\"DataProcessamento\": \"2019-12-17T00:00:00Z\",\"NIP\": \"3705693\",\"CodigoTipoOperacao\": 10,\"CodigoMoeda\": \"EUR\",\"CodigoSituacao\": 2,\"DescricaoSituacao\": \"REGULAR\",\"CodigoProdutoAplicacional\": \"128\",\"dataFimOperacao\": \"1900-01-01\",\"CodigoAplicacional\": \"\",\"DadosOIC\": {\"CodigoAplicacao\": \"\",\"DataInicioOperacao\": \"1900-01-01\",\"DataFimOperacao\": \"1900-01-01\",\"NumeroUnidades\": \"0.0\",\"DadosTaxa\": {\"ValorActual\": \"0.0\",\"DataInicio\": \"1900-01-01\",\"DataFim\": \"1900-01-01\",\"ValorDevedora\": \"0.0\",\"ValorCredora\": \"0.0\"},\"DadosLimiteCredito\": {\"Valor\": \"0.0\",\"DataFim\": \"1900-01-01\"},\"ValorIncumprimento\": \"0.0\",\"DataIncumprimento\": \"1900-01-01\",\"MontanteMedioUltimos3Meses\": \"0.0\",\"TipoAgregador\": \"Disponibilidades\"}}}, {\"IS_POSIProduto\": {\"CodigoFamilia\": \"1\",\"CodigoSubFamilia\": \"4\",\"Codigo\": \"104\",\"DescricaoTitulo\": \"CONTA POUPANCA RENDIMENTO\",\"Valor\": \"1000.00\",\"ValorMoedaProduto\": \"1000.00\",\"NumeroOperacao\": \"196251112801007\",\"DescricaoOperacao\": \"DISPONIBILIDADES\",\"DataProcessamento\": \"2019-12-17T00:00:00Z\",\"NIP\": \"3705693\",\"CodigoTipoOperacao\": 10,\"CodigoMoeda\": \"EUR\",\"CodigoSituacao\": 2,\"DescricaoSituacao\": \"REGULAR\",\"CodigoProdutoAplicacional\": \"128\",\"dataFimOperacao\": \"1900-01-01\",\"CodigoAplicacional\": \"\",\"DadosOIC\": {\"CodigoAplicacao\": \"\",\"DataInicioOperacao\": \"1900-01-01\",\"DataFimOperacao\": \"1900-01-01\",\"NumeroUnidades\": \"0.0\",\"DadosTaxa\": {\"ValorActual\": \"0.0\",\"DataInicio\": \"1900-01-01\",\"DataFim\": \"1900-01-01\",\"ValorDevedora\": \"0.0\",\"ValorCredora\": \"0.0\"},\"DadosLimiteCredito\": {\"Valor\": \"0.0\",\"DataFim\": \"1900-01-01\"},\"ValorIncumprimento\": \"0.0\",\"DataIncumprimento\": \"1900-01-01\",\"MontanteMedioUltimos3Meses\": \"0.0\",\"TipoAgregador\": \"Disponibilidades\"}}}]},\"Cor\": \"#FFAB74\",\"ProdutoPrivateList\": {\"List\": [],\"EmptyListItem\": {\"IS_POSIProdutoPrivate\": {\"CodigoFamilia\": \"\",\"CodigoSubFamilia\": \"\",\"Codigo\": \"\",\"DescricaoTitulo\": \"\",\"NumeroOperacao\": \"0\",\"CodigoMoeda\": \"\",\"ValorAplicado\": \"0.0\",\"ValorMoedaProduto\": \"0.0\",\"Valor\": \"0.0\",\"Taxa\": \"0.0\",\"Ultimacotacao\": \"\",\"QuantidadeMontante\": \"0.0\",\"QuantidadeMontante2\": \"0.0\",\"PercentagemCarteira\": \"0.0\",\"CodigoAplicacional\": \"\"}}},\"Order\": \"0\"}}]},\"Order\": \"0\"},\"POSIFamilaPassiva\": {\"Descricao\": \"Passivos\",\"Total\": \"-92282.66\",\"SubFamiliaList\": {\"List\": [{\"IS_POSISubFamilia\": {\"CodigoAlfa\": \"P09\",\"Descricao\": \"Crédito Habitação\",\"Total\": \"-68361.92\",\"ProdutoList\": {\"List\": [{\"IS_POSIProduto\": {\"CodigoFamilia\": \"10\",\"CodigoSubFamilia\": \"39\",\"Codigo\": \"1200\",\"DescricaoTitulo\": \"C.HABITACAO - GERAL\",\"Valor\": \"-68361.92\",\"ValorMoedaProduto\": \"-68361.92\",\"NumeroOperacao\": \"1962511165001\",\"DescricaoOperacao\": \"RESPONSABILIDADES\",\"DataProcessamento\": \"2019-12-17T00:00:00Z\",\"NIP\": \"3705693\",\"CodigoTipoOperacao\": 20,\"CodigoMoeda\": \"EUR\",\"CodigoSituacao\": 2,\"DescricaoSituacao\": \"REGULAR\",\"CodigoProdutoAplicacional\": \"106100200\",\"dataFimOperacao\": \"1900-01-01\",\"CodigoAplicacional\": \"\",\"DadosOIC\": {\"CodigoAplicacao\": \"\",\"DataInicioOperacao\": \"1900-01-01\",\"DataFimOperacao\": \"1900-01-01\",\"NumeroUnidades\": \"0.0\",\"DadosTaxa\": {\"ValorActual\": \"0.0\",\"DataInicio\": \"1900-01-01\",\"DataFim\": \"1900-01-01\",\"ValorDevedora\": \"0.0\",\"ValorCredora\": \"0.0\"},\"DadosLimiteCredito\": {\"Valor\": \"0.0\",\"DataFim\": \"1900-01-01\"},\"ValorIncumprimento\": \"0.0\",\"DataIncumprimento\": \"1900-01-01\",\"MontanteMedioUltimos3Meses\": \"0.0\",\"TipoAgregador\": \"Disponibilidades\"}}}]},\"Cor\": \"#FF6200\",\"ProdutoPrivateList\": {\"List\": [],\"EmptyListItem\": {\"IS_POSIProdutoPrivate\": {\"CodigoFamilia\": \"\",\"CodigoSubFamilia\": \"\",\"Codigo\": \"\",\"DescricaoTitulo\": \"\",\"NumeroOperacao\": \"0\",\"CodigoMoeda\": \"\",\"ValorAplicado\": \"0.0\",\"ValorMoedaProduto\": \"0.0\",\"Valor\": \"0.0\",\"Taxa\": \"0.0\",\"Ultimacotacao\": \"\",\"QuantidadeMontante\": \"0.0\",\"QuantidadeMontante2\": \"0.0\",\"PercentagemCarteira\": \"0.0\",\"CodigoAplicacional\": \"\"}}},\"Order\": \"0\"}}, {\"IS_POSISubFamilia\": {\"CodigoAlfa\": \"P07\",\"Descricao\": \"Crédito Pessoal\",\"Total\": \"-21671.05\",\"ProdutoList\": {\"List\": [{\"IS_POSIProduto\": {\"CodigoFamilia\": \"8\",\"CodigoSubFamilia\": \"30\",\"Codigo\": \"1300\",\"DescricaoTitulo\": \"CREDITO CONSUMO\",\"Valor\": \"-15975.66\",\"ValorMoedaProduto\": \"-15975.66\",\"NumeroOperacao\": \"1962511830005\",\"DescricaoOperacao\": \"RESPONSABILIDADES\",\"DataProcessamento\": \"2019-12-17T00:00:00Z\",\"NIP\": \"3705693\",\"CodigoTipoOperacao\": 20,\"CodigoMoeda\": \"EUR\",\"CodigoSituacao\": 2,\"DescricaoSituacao\": \"REGULAR\",\"CodigoProdutoAplicacional\": \"200200103\",\"dataFimOperacao\": \"1900-01-01\",\"CodigoAplicacional\": \"\",\"DadosOIC\": {\"CodigoAplicacao\": \"\",\"DataInicioOperacao\": \"1900-01-01\",\"DataFimOperacao\": \"1900-01-01\",\"NumeroUnidades\": \"0.0\",\"DadosTaxa\": {\"ValorActual\": \"0.0\",\"DataInicio\": \"1900-01-01\",\"DataFim\": \"1900-01-01\",\"ValorDevedora\": \"0.0\",\"ValorCredora\": \"0.0\"},\"DadosLimiteCredito\": {\"Valor\": \"0.0\",\"DataFim\": \"1900-01-01\"},\"ValorIncumprimento\": \"0.0\",\"DataIncumprimento\": \"1900-01-01\",\"MontanteMedioUltimos3Meses\": \"0.0\",\"TipoAgregador\": \"Disponibilidades\"}}}, {\"IS_POSIProduto\": {\"CodigoFamilia\": \"8\",\"CodigoSubFamilia\": \"30\",\"Codigo\": \"1402\",\"DescricaoTitulo\": \"CREDITO CONSUMO – IMEDIATO\",\"Valor\": \"-5505.39\",\"ValorMoedaProduto\": \"-5505.39\",\"NumeroOperacao\": \"1962511830006\",\"DescricaoOperacao\": \"RESPONSABILIDADES\",\"DataProcessamento\": \"2019-12-17T00:00:00Z\",\"NIP\": \"3705693\",\"CodigoTipoOperacao\": 20,\"CodigoMoeda\": \"EUR\",\"CodigoSituacao\": 2,\"DescricaoSituacao\": \"REGULAR\",\"CodigoProdutoAplicacional\": \"200200113\",\"dataFimOperacao\": \"1900-01-01\",\"CodigoAplicacional\": \"\",\"DadosOIC\": {\"CodigoAplicacao\": \"\",\"DataInicioOperacao\": \"1900-01-01\",\"DataFimOperacao\": \"1900-01-01\",\"NumeroUnidades\": \"0.0\",\"DadosTaxa\": {\"ValorActual\": \"0.0\",\"DataInicio\": \"1900-01-01\",\"DataFim\": \"1900-01-01\",\"ValorDevedora\": \"0.0\",\"ValorCredora\": \"0.0\"},\"DadosLimiteCredito\": {\"Valor\": \"0.0\",\"DataFim\": \"1900-01-01\"},\"ValorIncumprimento\": \"0.0\",\"DataIncumprimento\": \"1900-01-01\",\"MontanteMedioUltimos3Meses\": \"0.0\",\"TipoAgregador\": \"Disponibilidades\"}}}, {\"IS_POSIProduto\": {\"CodigoFamilia\": \"8\",\"CodigoSubFamilia\": \"90\",\"Codigo\": \"7713\",\"DescricaoTitulo\": \"SAMSUNG S9 PLUS\",\"Valor\": \"-190.00\",\"ValorMoedaProduto\": \"-190.00\",\"NumeroOperacao\": \"1962511830004\",\"DescricaoOperacao\": \"RESPONSABILIDADES\",\"DataProcessamento\": \"2019-12-17T00:00:00Z\",\"NIP\": \"3705693\",\"CodigoTipoOperacao\": 20,\"CodigoMoeda\": \"EUR\",\"CodigoSituacao\": 2,\"DescricaoSituacao\": \"REGULAR\",\"CodigoProdutoAplicacional\": \"201208625\",\"dataFimOperacao\": \"1900-01-01\",\"CodigoAplicacional\": \"\",\"DadosOIC\": {\"CodigoAplicacao\": \"\",\"DataInicioOperacao\": \"1900-01-01\",\"DataFimOperacao\": \"1900-01-01\",\"NumeroUnidades\": \"0.0\",\"DadosTaxa\": {\"ValorActual\": \"0.0\",\"DataInicio\": \"1900-01-01\",\"DataFim\": \"1900-01-01\",\"ValorDevedora\": \"0.0\",\"ValorCredora\": \"0.0\"},\"DadosLimiteCredito\": {\"Valor\": \"0.0\",\"DataFim\": \"1900-01-01\"},\"ValorIncumprimento\": \"0.0\",\"DataIncumprimento\": \"1900-01-01\",\"MontanteMedioUltimos3Meses\": \"0.0\",\"TipoAgregador\": \"Disponibilidades\"}}}]},\"Cor\": \"#FFAB74\",\"ProdutoPrivateList\": {\"List\": [],\"EmptyListItem\": {\"IS_POSIProdutoPrivate\": {\"CodigoFamilia\": \"\",\"CodigoSubFamilia\": \"\",\"Codigo\": \"\",\"DescricaoTitulo\": \"\",\"NumeroOperacao\": \"0\",\"CodigoMoeda\": \"\",\"ValorAplicado\": \"0.0\",\"ValorMoedaProduto\": \"0.0\",\"Valor\": \"0.0\",\"Taxa\": \"0.0\",\"Ultimacotacao\": \"\",\"QuantidadeMontante\": \"0.0\",\"QuantidadeMontante2\": \"0.0\",\"PercentagemCarteira\": \"0.0\",\"CodigoAplicacional\": \"\"}}},\"Order\": \"0\"}}, {\"IS_POSISubFamilia\": {\"CodigoAlfa\": \"P06\",\"Descricao\": \"Cartões de Crédito\",\"Total\": \"-2249.69\",\"ProdutoList\": {\"List\": [{\"IS_POSIProduto\": {\"CodigoFamilia\": \"7\",\"CodigoSubFamilia\": \"87\",\"Codigo\": \"5001\",\"DescricaoTitulo\": \"BPI PREMIO\",\"Valor\": \"-2249.69\",\"ValorMoedaProduto\": \"-2249.69\",\"NumeroOperacao\": \"4406370583247\",\"DescricaoOperacao\": \"RESPONSABILIDADES\",\"DataProcessamento\": \"2019-12-17T00:00:00Z\",\"NIP\": \"3705693\",\"CodigoTipoOperacao\": 20,\"CodigoMoeda\": \"EUR\",\"CodigoSituacao\": 2,\"DescricaoSituacao\": \"REGULAR\",\"CodigoProdutoAplicacional\": \"440637\",\"dataFimOperacao\": \"1900-01-01\",\"CodigoAplicacional\": \"\",\"DadosOIC\": {\"CodigoAplicacao\": \"\",\"DataInicioOperacao\": \"1900-01-01\",\"DataFimOperacao\": \"1900-01-01\",\"NumeroUnidades\": \"0.0\",\"DadosTaxa\": {\"ValorActual\": \"0.0\",\"DataInicio\": \"1900-01-01\",\"DataFim\": \"1900-01-01\",\"ValorDevedora\": \"0.0\",\"ValorCredora\": \"0.0\"},\"DadosLimiteCredito\": {\"Valor\": \"0.0\",\"DataFim\": \"1900-01-01\"},\"ValorIncumprimento\": \"0.0\",\"DataIncumprimento\": \"1900-01-01\",\"MontanteMedioUltimos3Meses\": \"0.0\",\"TipoAgregador\": \"Disponibilidades\"}}}]},\"Cor\": \"#F8E0CD\",\"ProdutoPrivateList\": {\"List\": [],\"EmptyListItem\": {\"IS_POSIProdutoPrivate\": {\"CodigoFamilia\": \"\",\"CodigoSubFamilia\": \"\",\"Codigo\": \"\",\"DescricaoTitulo\": \"\",\"NumeroOperacao\": \"0\",\"CodigoMoeda\": \"\",\"ValorAplicado\": \"0.0\",\"ValorMoedaProduto\": \"0.0\",\"Valor\": \"0.0\",\"Taxa\": \"0.0\",\"Ultimacotacao\": \"\",\"QuantidadeMontante\": \"0.0\",\"QuantidadeMontante2\": \"0.0\",\"PercentagemCarteira\": \"0.0\",\"CodigoAplicacional\": \"\"}}},\"Order\": \"0\"}}]},\"Order\": \"0\"},\"TransactionStatus\": {\"TransactionStatus\": {\"OperationStatusId\": 1,\"TransactionErrors\": {\"List\": [],\"EmptyListItem\": {\"TransactionError\": {\"Source\": \"\",\"Code\": \"\",\"Level\": 0,\"Description\": \"\"}}},\"AuthStatusReason\": {\"List\": [],\"EmptyListItem\": {\"Status\": \"\",\"Code\": \"\",\"Description\": \"\"}}}},\"MobileChallenge\": {\"Id\": 0,\"CreationDate\": \"1900-01-01T00:00:00\",\"UUID\": \"\",\"MobileChallengeRequestedToken\": {\"List\": [],\"EmptyListItem\": {\"UUID\": \"\",\"TokenDefinition\": \"\",\"ChallengeTokenType\": \"\"}}},\"RequestValid\": true}}";

    @Test
    public void shouldParseAssetsAndLiabilitiesProductsData() throws IOException, RequestException {
        // given
        // when
        ProductsFetchResponse objectUnderTest = new ProductsFetchResponse(RESPONSE_EXPECTED);
        // then
        Assert.assertEquals(5, objectUnderTest.getProductsData().getAssetsProductsData().size());
        Assert.assertEquals(
                5, objectUnderTest.getProductsData().getLiabilitiesProductsData().size());
    }

    @Test
    public void shouldParseToProductData() throws RequestException {
        // given
        ProductsFetchResponse objectUnderTest = new ProductsFetchResponse(RESPONSE_EXPECTED);
        // when
        BancoBpiProductData result =
                objectUnderTest.getProductsData().getAssetsProductsData().get(0);
        // then
        Assert.assertEquals("A00", result.getCodeAlfa());
        Assert.assertEquals("0", result.getCodeFamily());
        Assert.assertEquals("0", result.getCodeSubFamily());
        Assert.assertEquals("25", result.getCode());
        Assert.assertEquals("CONTA VALOR BPI", result.getName().trim());
        Assert.assertEquals(new BigDecimal("1237.24"), result.getBalance());
        Assert.assertEquals("EUR", result.getCurrencyCode());
        Assert.assertEquals("1962511000001", result.getNumber());
    }

    @Test(expected = RequestException.class)
    public void shouldThrowExceptionWhenResponseHasUnexpectedFormat() throws RequestException {
        // given
        final String response =
                "{\"versionInfo\": {\"hasModuleVersionChanged\": true,\"hasApiVersionChanged\": false},\"data\": {},\"exception\": {\"name\": \"NotRegisteredException\",\"specificType\": \"CSM_Fundos.NotR_FND_Write2\",\"message\": \"R_FND_Write2 role required\"},\"rolesInfo\": \",\"}";
        // when
        new ProductsFetchResponse(response);
    }
}
