
-----------------------------------------------------------------------------------
REQUEST 1
POST https://psd2.iccreabanca.it/auth/oauth/v2/token?grant_type=client_credentials&scope=production
Content-Type: application/x-www-form-urlencoded
Authorization: Basic ZHVtbXlDbGllbnRJZDpkdW1teUNsaWVudFNlY3JldA==

-----------------------------------------------------------------------------------
RESPONSE 1
200
Date: Wed, 26 Jan 2022 15:59:35 GMT
Date: Wed, 26 Jan 2022 15:59:36 GMT
Content-Type: application/json;charset=utf-8

{
  "access_token":"dummyAccessToken",
  "token_type":"Bearer",
  "expires_in":300,
  "scope":"production"
}

-----------------------------------------------------------------------------------
REQUEST 2
POST https://psd2.iccreabanca.it/platform/enabler/psd2orchestrator/ais/3.0.0/consents
Content-Type: application/json
Authorization: Bearer dummyAccessToken
x-request-id: 00000000-0000-4000-0000-000000000000
aspsp-code: 08530
date: Fri, 10 Apr 1992 12:00:00 UTC
aspsp-product-code: relax
tpp-redirect-uri: https://127.0.0.1:7357/api/v1/thirdparty/callback?state=00000000-0000-4000-0000-000000000000&result=success
tpp-nok-redirect-uri: https://127.0.0.1:7357/api/v1/thirdparty/callback?state=00000000-0000-4000-0000-000000000000&result=failure

{
  "access": {
    "allPsd2": "allAccountsWithOwnerName"
  },
  "combinedServiceIndicator": false,
  "frequencyPerDay": 4,
  "recurringIndicator": true,
  "validUntil": "1992-07-08"
}

-----------------------------------------------------------------------------------
RESPONSE 2
201
Date: Wed, 26 Jan 2022 15:59:36 GMT
Date: Wed, 26 Jan 2022 15:59:35 GMT
X-Frame-Options: SAMEORIGIN
X-Frame-Options: SAMEORIGIN
x-request-id: 00000000-0000-4000-0000-000000000000
Location: https://psd2.iccreabanca.it/consents/test_consent_id
X-Content-Type-Options: nosniff
Content-Type: application/json

{
  "consentStatus": "received",
  "consentId": "test_consent_id",
  "scaMethods": [
    {
      "authenticationMethodId": "4",
      "authenticationType": "SMS_OTP",
      "explanation": "Riceverai un SMS contenente l\u0027OTP da inserire per autorizzare l\u0027operazione"
    },
    {
      "authenticationMethodId": "3",
      "authenticationType": "PHOTO_OTP",
      "name": "QRCode",
      "explanation": "Inquadra con la tua app RelaxBanking il QRCode. Inserisci il codice che vedi sullo schermo dello smartphone e conferma"
    },
    {
      "authenticationMethodId": "2",
      "authenticationType": "PUSH_OTP",
      "explanation": "Autorizza l\u0027operazione attraverso la notifica che hai ricevuto sulla app Relax Banking"
    },
    {
      "authenticationMethodId": "1",
      "authenticationType": "CHIP_OTP",
      "explanation": "Inserisci il codice generato dal tuo token fisico"
    }
  ],
  "_links": {
    "selectAuthenticationMethod": {
      "href": "/consents/test_consent_id"
    },
    "self": {
      "href": "/consents/test_consent_id"
    }
  }
}

-----------------------------------------------------------------------------------
REQUEST 3
PUT https://psd2.iccreabanca.it/platform/enabler/psd2orchestrator/ais/2.3.2/consents/test_consent_id
Content-Type: application/json
Authorization: Bearer dummyAccessToken
x-request-id: 00000000-0000-4000-0000-000000000000
aspsp-code: 08530
date: Fri, 10 Apr 1992 12:00:00 UTC
operation-name: updatePsuData

{
  "authenticationMethodId": "2"
}

-----------------------------------------------------------------------------------
RESPONSE 3 SET SCA_METHOD_SELECTED
200
Date: Wed, 26 Jan 2022 15:59:36 GMT
Date: Wed, 26 Jan 2022 15:59:36 GMT
X-Frame-Options: SAMEORIGIN
X-Frame-Options: SAMEORIGIN
aspsp-sca-approach: DECOUPLED
x-request-id: 00000000-0000-4000-0000-000000000000
X-Content-Type-Options: nosniff
Content-Type: application/json

{
  "_links": {
    "updatePsuAuthentication": {
      "href": "/consents/test_consent_id"
    },
    "self": {
      "href": "/consents/test_consent_id"
    }
  },
  "consentStatus": "received",
  "psuCredentials": {
    "aspspProductCode": "RELAX",
    "credentialsDetails": [
      {
        "credentialDetailId": "USERNAME",
        "isSecret": "false",
        "labelList": [
          {
            "label": "username",
            "language": "EN"
          },
          {
            "label": "codice utente",
            "language": "IT"
          },
          {
            "label": "Benutzercode",
            "language": "DE"
          },
          {
            "label": "Uporabnik koda",
            "language": "SI"
          }
        ]
      },
      {
        "credentialDetailId": "PASSWORD",
        "isSecret": "true",
        "labelList": [
          {
            "label": "password",
            "language": "EN"
          },
          {
            "label": "password",
            "language": "IT"
          },
          {
            "label": "password",
            "language": "DE"
          },
          {
            "label": "password",
            "language": "SI"
          }
        ]
      }
    ]
  }
}

-----------------------------------------------------------------------------------
REQUEST 4 MATCH SCA_METHOD_SELECTED
PUT https://psd2.iccreabanca.it/platform/enabler/psd2orchestrator/ais/2.3.2/consents/test_consent_id
Content-Type: application/json
Authorization: Bearer dummyAccessToken
x-request-id: 00000000-0000-4000-0000-000000000000
aspsp-code: 08530
date: Fri, 10 Apr 1992 12:00:00 UTC
operation-name: updatePsuData

{
  "psuCredentials": {
    "productCode": "RELAX",
    "credentialsDetails": [
      {
        "credentialDetailId": "USERNAME",
        "credentialValue": "test_username"
      },
      {
        "credentialDetailId": "PASSWORD",
        "credentialValue": "test_password"
      }
    ]
  }
}

-----------------------------------------------------------------------------------
RESPONSE 4
200
Date: Wed, 26 Jan 2022 15:59:37 GMT
Date: Wed, 26 Jan 2022 15:59:37 GMT
X-Frame-Options: SAMEORIGIN
X-Frame-Options: SAMEORIGIN
aspsp-sca-approach: DECOUPLED
x-request-id: 00000000-0000-4000-0000-000000000000
X-Content-Type-Options: nosniff
Content-Type: application/json

{
  "psuId": "**HASHED:Xe**0039673000",
  "_links": {
    "self": {
      "href": "/consents/test_consent_id"
    }
  },
  "transactionStatus": "ACTC",
  "psuMessage": "Per autorizzare l\u0027operazione, vai sul tuo Smartphone e conferma la tua identita\u0027.",
  "consentStatus": "received"
}

-----------------------------------------------------------------------------------
REQUEST 5
GET https://psd2.iccreabanca.it/platform/enabler/psd2orchestrator/ais/2.3.2/consents/test_consent_id/status
Content-Type: application/json
Authorization: Bearer dummyAccessToken
x-request-id: 00000000-0000-4000-0000-000000000000
aspsp-code: 08530
date: Fri, 10 Apr 1992 12:00:00 UTC

-----------------------------------------------------------------------------------
RESPONSE 5 SET POLL1
200
Date: Wed, 26 Jan 2022 16:00:15 GMT
Date: Wed, 26 Jan 2022 16:00:15 GMT
X-Frame-Options: SAMEORIGIN
X-Frame-Options: SAMEORIGIN
x-request-id: 00000000-0000-4000-0000-000000000000
X-Content-Type-Options: nosniff
Content-Type: application/json

{
  "consentStatus": "received"
}

-----------------------------------------------------------------------------------
REQUEST 6 MATCH POLL1
GET https://psd2.iccreabanca.it/platform/enabler/psd2orchestrator/ais/2.3.2/consents/test_consent_id/status
Content-Type: application/json
Authorization: Bearer dummyAccessToken
x-request-id: 00000000-0000-4000-0000-000000000000
aspsp-code: 08530
date: Fri, 10 Apr 1992 12:00:00 UTC

-----------------------------------------------------------------------------------
RESPONSE 6
200
Date: Wed, 26 Jan 2022 16:00:15 GMT
Date: Wed, 26 Jan 2022 16:00:15 GMT
X-Frame-Options: SAMEORIGIN
X-Frame-Options: SAMEORIGIN
x-request-id: 00000000-0000-4000-0000-000000000000
X-Content-Type-Options: nosniff
Content-Type: application/json

{
  "consentStatus": "valid"
}

-----------------------------------------------------------------------------------
REQUEST 7
GET https://psd2.iccreabanca.it/platform/enabler/psd2orchestrator/ais/3.0.0/consents/test_consent_id
Content-Type: application/json
Authorization: Bearer dummyAccessToken
x-request-id: 00000000-0000-4000-0000-000000000000
aspsp-code: 08530
date: Fri, 10 Apr 1992 12:00:00 UTC

-----------------------------------------------------------------------------------
RESPONSE 7
200
Date: Wed, 26 Jan 2022 16:00:17 GMT
Date: Wed, 26 Jan 2022 16:00:16 GMT
X-Frame-Options: SAMEORIGIN
X-Frame-Options: SAMEORIGIN
x-request-id: 00000000-0000-4000-0000-000000000000
X-Content-Type-Options: nosniff
Content-Type: application/json

{
  "access": {
    "allPsd2": "allAccountsWithOwnerName"
  },
  "recurringIndicator": "true",
  "validUntil": "2022-04-25T23:59:59Z",
  "frequencyPerDay": "4",
  "lastActionDate": "2022-01-26",
  "consentStatus": "valid",
  "scaStatus": "VERIFIED"
}

-----------------------------------------------------------------------------------
REQUEST 8
GET https://psd2.iccreabanca.it/platform/enabler/psd2orchestrator/ais/3.0.0/accounts
Content-Type: application/json
Authorization: Bearer dummyAccessToken
aspsp-code: 08530
date: Fri, 10 Apr 1992 12:00:00 UTC
consent-id: test_consent_id
psu-ip-address: 127.0.0.1

-----------------------------------------------------------------------------------
RESPONSE 8
200
Date: Wed, 26 Jan 2022 16:00:16 GMT
Date: Wed, 26 Jan 2022 16:00:16 GMT
X-Frame-Options: SAMEORIGIN
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
Content-Type: application/json

{
  "accounts": [
    {
      "iban": "IT15P**HASHED:Xe**01002000000002387",
      "currency": "EUR",
      "resourceId": "**HASHED:Xe**08I4C-P**HASHED:Xe**01002000000002387-0002-EUR",
      "name": "**HASHED:Xe** 01002 000000002387 conti correnti **HASHED:kH**",
      "ownerName": "**HASHED:kH**",
      "_links": {
        "account": {
          "href": "/accounts/**HASHED:Xe**08I4C-P**HASHED:Xe**01002000000002387-0002-EUR"
        },
        "balances": {
          "href": "/accounts/**HASHED:Xe**08I4C-P**HASHED:Xe**01002000000002387-0002-EUR/balances"
        },
        "transactions": {
          "href": "/accounts/**HASHED:Xe**08I4C-P**HASHED:Xe**01002000000002387-0002-EUR/transactions"
        }
      }
    }
  ]
}
