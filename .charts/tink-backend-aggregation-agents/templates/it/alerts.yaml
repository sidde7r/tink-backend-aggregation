kind: RuleGroup
apiVersion: monitoring.tink.se/v1
metadata:
  name: alerts-it
  namespace: agents
spec:
  rules:
    ##### RE #####

    #######################################################
    ### All login success rates - Temporary Errors - RE ###
    #######################################################

    - alert: all_login_success_rates_below50_and_greater40_with_temporary_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.5
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.4
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and all authentication types with temporary errors is between 40 - 50% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below40_and_greater30_with_temporary_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.4
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.3
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all authentication types with temporary errors is between 30 - 40% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below30_and_greater20_with_temporary_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.3
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.2
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all authentication types with temporary errors is between 20 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below20_with_temporary_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.2
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all authentication types with temporary errors is below 20% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    #########################################################
    ### Split login success rates - Temporary Errors - RE ###
    #########################################################

    - alert: split_login_success_rates_below50_and_greater40_with_temporary_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.5
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.4
        and sum by (provider) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with temporary errors is between 40 - 50% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below40_and_greater30_with_temporary_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.4
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.3
        and sum by (provider) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with temporary errors is between 30 - 40% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below30_and_greater20_with_temporary_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.3
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.2
        and sum by (provider) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with temporary errors is between 20 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below20_with_temporary_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.2
        and sum by (provider) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with temporary errors is below 20% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    ############################################################
    ### All login success rates - Authentication Errors - RE ###
    ############################################################

    - alert: all_login_success_rates_below40_and_greater30_with_authentication_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.4
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.3
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and all authentication types with authentication errors is between 30 - 40% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below30_and_greater20_with_authentication_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.3
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.2
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all authentication types with authentication errors is between 20 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below20_and_greater10_with_authentication_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.2
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.1
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all authentication types with authentication errors is between 10 - 20% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below10_with_authentication_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.1
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all authentication types with authentication errors is below 10% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    ##############################################################
    ### Split login success rates - Authentication Errors - RE ###
    ##############################################################

    - alert: split_login_success_rates_below40_and_greater30_with_authentication_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.4
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.3
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: 5m
      labels:
        severity: urgent
        priority: {{ .Values.p4WaitTimeBeforeFiringAlert }}
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with authentication errors is between 30 - 40% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below30_and_greater20_with_authentication_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.3
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.2
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with authentication errors is between 20 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below20_and_greater10_with_authentication_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.2
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.1
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with authentication errors is between 10 - 20% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below10_with_authentication_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.1
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with authentication errors is below 10% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    ##################################################
    ### All login success rates - Bank Errors - RE ###
    ##################################################

    - alert: all_login_success_rates_below40_and_greater30_with_bank_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.4
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.3
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and all Bank types with Bank errors is between 30 - 40% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below30_and_greater20_with_bank_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.3
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.2
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all Bank types with Bank errors is between 20 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below20_and_greater10_with_bank_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.2
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.1
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all Bank types with Bank errors is between 10 - 20% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below10_with_bank_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.1
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all Bank types with Bank errors is below 10% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    ####################################################
    ### Split login success rates - Bank Errors - RE ###
    ####################################################

    - alert: split_login_success_rates_below40_and_greater30_with_bank_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.4
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.3
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with Bank errors is between 30 - 40% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below30_and_greater20_with_bank_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.3
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.2
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with Bank errors is between 20 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below20_and_greater10_with_bank_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.2
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.1
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with Bank errors is between 10 - 20% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below10_with_bank_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.1
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with Bank errors is below 10% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    ###################################################
    ### All login success rates - Agent Errors - RE ###
    ###################################################

    - alert: all_login_success_rates_below35_and_greater30_with_agent_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.35
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.3
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and all Agent types with Agent errors is between 30 - 35% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below30_and_greater20_with_agent_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.3
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.2
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all Agent types with Agent errors is between 20 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below20_and_greater10_with_agent_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.2
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.1
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all Agent types with Agent errors is between 10 - 20% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below10_with_agent_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.1
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all Agent types with Agent errors is below 10% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    #####################################################
    ### Split login success rates - Agent Errors - RE ###
    #####################################################

    - alert: split_login_success_rates_below35_and_greater30_with_agent_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.35
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.3
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with Agent errors is between 30 - 35% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below30_and_greater20_with_agent_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.3
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.2
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with Agent errors is between 20 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below20_and_greater10_with_agent_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.2
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.1
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with Agent errors is between 10 - 20% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below10_with_agent_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.1
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with Agent errors is below 10% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    #################################################
    ### All login success rates - All Errors - RE ###
    #################################################

    - alert: all_login_success_rates_below30_and_greater25_with_all_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.30
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.25
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and all Agent types with All Errors is between 25 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below25_and_greater15_with_all_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.25
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.15
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all Agent types with All Errors is between 15 - 25% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below15_and_greater10_with_all_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.15
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.1
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all Agent types with All Errors is between 10 - 15% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below10_with_all_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.1
        and sum by (provider) (tink_agent_login_total{ {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for all Agent types with All Errors is below 10% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    ###################################################
    ### Split login success rates - All Errors - RE ###
    ###################################################

    - alert: split_login_success_rates_below30_and_greater25_with_all_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.30
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.25
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with All Errors is between 25 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below25_and_greater15_with_all_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.25
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.15
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with All Errors is between 15 - 25% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below15_and_greater10_with_all_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.15
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) >= 0.1
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with All Errors is between 10 - 15% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below10_with_all_errors_and_attempt_limit_it_re
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})) < 0.1
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.reAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for RE agents and for one of login type with All Errors is below 10% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

        ##### OpenBanking #####

    ############################################################
    ### All login success rates - Temporary Errors - OB ###
    ############################################################

    - alert: all_login_success_rates_below75_and_greater60_with_temporary_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.75
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.6
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and all authentication types with temporary errors is between 60 - 75% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below60_and_greater50_with_temporary_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.6
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.5
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all authentication types with temporary errors is between 50 - 60% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below50_and_greater40_with_temporary_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.5
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.4
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all authentication types with temporary errors is between 40 - 50% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below40_with_temporary_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.4
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all authentication types with temporary errors is below 40% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}


    #########################################################
    ### Split login success rates - Temporary Errors - OB ###
    #########################################################

    - alert: split_login_success_rates_below75_and_greater60_with_temporary_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.75
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.6
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with temporary errors is between 60 - 75% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below60_and_greater50_with_temporary_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.6
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.5
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with temporary errors is between 50 - 60% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below50_and_greater40_with_temporary_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.5
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.4
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with temporary errors is between 40 - 50% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below40_with_temporary_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.temporaryErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.4
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with temporary errors is below 40% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    ############################################################
    ### All login success rates - Authentication Errors - OB ###
    ############################################################

    - alert: all_login_success_rates_below50_and_greater30_with_authentication_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.5
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.3
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and all authentication types with authentication errors is between 30 - 50% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below30_and_greater20_with_authentication_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.3
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.2
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all authentication types with authentication errors is between 20 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below20_and_greater10_with_authentication_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.2
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.1
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all authentication types with authentication errors is between 10 - 20% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below10_with_authentication_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.1
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all authentication types with authentication errors is below 10% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    ##############################################################
    ### Split login success rates - Authentication Errors - OB ###
    ##############################################################

    - alert: split_login_success_rates_below50_and_greater30_with_authentication_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.5
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.3
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with authentication errors is between 30 - 50% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below30_and_greater20_with_authentication_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.3
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.2
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with authentication errors is between 20 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below20_and_greater10_with_authentication_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.2
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.1
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with authentication errors is between 10 - 20% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below10_with_authentication_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.authErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.1
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with authentication errors is below 10% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    ##################################################
    ### All login success rates - Bank Errors - OB ###
    ##################################################

    - alert: all_login_success_rates_below70_and_greater60_with_bank_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.7
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.6
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and all Bank types with Bank errors is between 60 - 70% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below60_and_greater50_with_bank_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.6
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.5
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all Bank types with Bank errors is between 50 - 60% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below50_and_greater40_with_bank_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.5
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.4
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all Bank types with Bank errors is between 50 - 60% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below40_with_bank_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.4
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all Bank types with Bank errors is below 50% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    ####################################################
    ### Split login success rates - Bank Errors - OB ###
    ####################################################

    - alert: split_login_success_rates_below70_and_greater60_with_bank_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.7
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.6
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with Bank errors is between 60 - 70% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below60_and_greater50_with_bank_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.6
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.5
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with Bank errors is between 50 - 60% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below50_and_greater40_with_bank_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.5
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.4
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with Bank errors is between 40 - 50% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below40_with_bank_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.bankErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.4
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with Bank errors is below 40% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    ###################################################
    ### All login success rates - Agent Errors - OB ###
    ###################################################

    - alert: all_login_success_rates_below40_and_greater30_with_agent_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.4
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.3
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and all Agent types with Agent errors is between 30 - 40% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below30_and_greater20_with_agent_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.3
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.2
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all Agent types with Agent errors is between 20 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below20_and_greater10_with_agent_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.2
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.1
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all Agent types with Agent errors is between 10 - 20% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below10_with_agent_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.1
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all Agent types with Agent errors is below 10% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    #####################################################
    ### Split login success rates - Agent Errors - OB ###
    #####################################################

    - alert: split_login_success_rates_below40_and_greater30_with_agent_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.4
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.3
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with Agent errors is between 30 - 40% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below30_and_greater20_with_agent_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.3
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.2
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with Agent errors is between 20 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below20_and_greater10_with_agent_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.2
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.1
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with Agent errors is between 10 - 20% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below10_with_agent_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.agentErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.1
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with Agent errors is below 10% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    #################################################
    ### All login success rates - All Errors - OB ###
    #################################################

    - alert: all_login_success_rates_below30_and_greater20_with_all_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.3
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.2
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and all Agent types with All Errors is between 20 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below20_and_greater10_with_all_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.2
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.1
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all Agent types with All Errors is between 10 - 20% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below10_and_greater5_with_all_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.1
        and (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.05
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all Agent types with All Errors is between 5 - 10% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: all_login_success_rates_below5_with_all_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.5
        and sum by (provider) (tink_agent_login_total{ {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for all Agent types with All Errors is below 5% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    ###################################################
    ### Split login success rates - All Errors - OB ###
    ###################################################

    - alert: split_login_success_rates_below30_and_greater20_with_all_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.3
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.2
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with All Errors is between 20 - 30% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below20_and_greater10_with_all_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.2
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.1
        and sum by (provider) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with All Errors is between 10 - 20% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below15_and_greater5_with_all_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.1
        and (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) >= 0.05
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with All Errors is between 15 - 25% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: split_login_success_rates_below5_with_all_errors_and_attempt_limit_it_ob
      expr: |
        (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", {{ .Values.allErrorsAuth }} , market="IT"}))
                    / (sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})) < 0.05
        and sum by (provider, action) (tink_agent_login_total{ {{ .Values.allLoginActions }}, {{ .Values.obAgents }}, provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaLink }}
          {{ .Values.grafanaLink }}
        summary: Login success rate for OB agents and for one of login type with All Errors is below 15% ( <{ $value }> ) for <{ $labels.className }> ( <{ $labels.provider }> )
          the last 30 minutes.
        tags: {{ .Values.tags }}

        #### Agent refresh ####

    ########################################
    ### BankServerErrors - Agent Refresh ###
    ########################################

    - alert: agent_refreshes_below60_greater50_due_to_bank_server_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.bankErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.6
        and (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.bankErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) >= 0.5
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is between 50 - 60% because of bank issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes for <{ $labels.type }>
        tags: {{ .Values.tags }}

    - alert: agent_refreshes_below50_greater40_due_to_bank_server_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.bankErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.5
        and (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.bankErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) >= 0.4
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is between 40 - 50% because of bank issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes for <{ $labels.type }>
        tags: {{ .Values.tags }}

    - alert: agent_refreshes_below40_greater30_due_to_bank_server_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.bankErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.4
        and (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.bankErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) >= 0.3
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is between 30 - 40% because of bank issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes for <{ $labels.type }>
        tags: {{ .Values.tags }}

    - alert: agent_refreshes_below30_due_to_bank_server_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.bankErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.3
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is below 30% because of bank issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes for <{ $labels.type }>
        tags: {{ .Values.tags }}

    - alert: manual_login_due_to_bank_side_error_rate_over_50%_IT
      expr: |
        (count by(provider, className) (count_over_time (tink_agent_login_total{ environment="production",market="IT", outcome="unavailable", action="login-manual"}[1h]))
        / count by(provider, className) (count_over_time (tink_agent_login_total{ environment="production",market="IT", action="login-manual"}[1h])) > 0.5 )
        and (count by(provider, className) (count_over_time (tink_agent_login_total{ environment="production",market="IT", action="login-manual"}[1h])) > 5)
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Manual login error rate more than 50% ( <{ $value }> * 100 ) % for provider <{ $labels.provider }> of agent <{ $labels.className }>
          the last {{ .Values.p2WaitTimeBeforeFiringAlert }} minutes.
        tags: {{ .Values.tags }}

    - alert: auto_login_due_to_bank_side_error_rate_over_50%_IT
      expr: |
        (count by(provider, className, action) (count_over_time (tink_agent_login_total{ environment="production",market="IT", outcome="unavailable", action=~"login-auto|login-cron"}[1h]))
        / count by(provider, className, action) (count_over_time (tink_agent_login_total{ environment="production",market="IT", action=~"login-auto|login-cron"}[1h])) > 0.5 )
        and (count by(provider, className, action) (count_over_time (tink_agent_login_total{ environment="production",market="IT", action=~"login-auto|login-cron"}[1h])) > 5)
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Auto login error rate more than 50% ( <{ $value }> * 100 ) % for action <{ $labels.action }> provider <{ $labels.provider }> of agent <{ $labels.className }>
          the last {{ .Values.p2WaitTimeBeforeFiringAlert }} minutes.
        tags: {{ .Values.tags }}

    #########################################
    ### AgentServerErrors - Agent Refresh ###
    #########################################

    - alert: agent_refreshes_below60_greater50_due_to_agent_server_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.agentErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.6
        and (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.agentErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) >= 0.5
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is between 50 - 60% because of agent issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes for <{ $labels.type }>
        tags: {{ .Values.tags }}

    - alert: agent_refreshes_below50_greater40_due_to_agent_server_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.agentErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.5
        and (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.agentErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) >= 0.4
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is between 40 - 50% because of agent issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes for <{ $labels.type }>
        tags: {{ .Values.tags }}

    - alert: agent_refreshes_below40_greater30_due_to_agent_server_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.agentErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.4
        and (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.agentErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) >= 0.3
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is between 30 - 40% because of agent issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes for <{ $labels.type }>
        tags: {{ .Values.tags }}

    - alert: agent_refreshes_below30_due_to_agent_server_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.agentErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.3
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is below 30% because of agent issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes for <{ $labels.type }>
        tags: {{ .Values.tags }}

    #################################
    ### AllErrors - Agent Refresh ###
    #################################

    - alert: agent_refreshes_below45_greater35_due_to_all_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.allErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.45
        and (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.allErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) >= 0.35
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is between 35 - 45% because of all issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes for <{ $labels.type }>
        tags: {{ .Values.tags }}

    - alert: agent_refreshes_below35_greater25_due_to_all_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.allErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.35
        and (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.allErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) >= 0.25
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is between 25 - 35% because of all issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes for <{ $labels.type }>
        tags: {{ .Values.tags }}

    - alert: agent_refreshes_below25_greater15_due_to_all_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.allErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.25
        and (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.allErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) >= 0.15
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is between 15 - 25% because of all issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes for <{ $labels.type }>
        tags: {{ .Values.tags }}

    - alert: agent_refreshes_below15_due_to_all_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.allErrorsRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.15
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is below 15% because of all issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes for <{ $labels.type }>
        tags: {{ .Values.tags }}

    ###############################################
    ### AllErrors - Partially Completed Refresh ###
    ###############################################

    - alert: agent_refreshes_below60_greater50_due_to_partially_completed_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.partiallyCompletedErrorRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.6
        and (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.partiallyCompletedErrorRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) >= 0.5
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p4WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P4
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is between 50 - 60% because of all issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: agent_refreshes_below50_greater40_due_to_partially_completed_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.partiallyCompletedErrorRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.5
        and (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.partiallyCompletedErrorRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) >= 0.4
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p3WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P3
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is between 40 - 50% because of all issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: agent_refreshes_below40_greater30_due_to_partially_completed_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.partiallyCompletedErrorRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.4
        and (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.partiallyCompletedErrorRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) >= 0.3
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p2WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P2
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is between 30 - 40% because of all issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes.
        tags: {{ .Values.tags }}

    - alert: agent_refreshes_below30_due_to_partially_completed_error_with_rate_limit_it
      expr: |
        (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", {{ .Values.partiallyCompletedErrorRefresh }}, market="IT"}))
            / (sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})) < 0.3
         and sum by (className,type) (tink_agent_refresh_total{provider_type!="test", market="IT"})  > 10
      for: {{ .Values.p1WaitTimeBeforeFiringAlert }}
      labels:
        severity: urgent
        priority: P1
        who: integration-nazguls
      annotations:
        description: {{ .Values.kibanaClassLink }}
          {{ .Values.grafanaLink }}
        summary: Refresh unavailable rate is below 30% because of all issues ( <{ $value }> ) for <{ $labels.className }>
          the last 30 minutes.
        tags: {{ .Values.tags }}
