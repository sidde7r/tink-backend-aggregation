kind: RuleGroup
apiVersion: monitoring.tink.se/v1
metadata:
  name: alerts-dk-long-term
  namespace: agents
spec:
  interval: 1h
  rules:
    - alert: UserLoginErrorRateAbove75%DK
      expr: |
        sum by (className) (sum_over_time(internal:sum:all_logins_by_type_outcome_dk:delta1h{outcome=~"cancelled.*"}[4h:1h]))
        /
        (sum by (className) (sum_over_time(internal:sum:all_logins_by_type_outcome_dk:delta1h[4h:1h])) >= 3) >= 0.75
      labels:
        priority: P3
        severity: ping
        who: integration-teletubbies
      annotations:
        description: <{{ .Values.kibanaClassLinkAbs4h }} |Kibana>
          <{{ .Values.grafanaClassLinkAbs4h }} |Grafana>
        summary: <{ $value | humanizePercentage }> user error login error rate for <{ $labels.className }> over the last 4 hours.
        tags: <{ $labels.className }>
